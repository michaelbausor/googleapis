steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-f', '.cloudbuild/Dockerfile.bazel-zip', '-t', 'bazel-zip', '.']
- name: 'bazel-zip'
  args:
  - 'build'
  - '//google/cloud/language/v1:gapi-cloud-language-v1-go'
  - '//google/cloud/language/v1:google-cloud-language-v1-java'
  - '//google/cloud/language/v1:google-cloud-language-v1-php'
  - '//google/cloud/vision/v1:gapi-cloud-vision-v1-go'
  - '//google/cloud/vision/v1:google-cloud-vision-v1-java'
- name: 'gcr.io/cloud-builders/gsutil'
  args: ['-m', 'cp', '-r', 'bazel-bin/google', '$_GS_BUCKET_URI/$COMMIT_SHA/google']
- name: 'ubuntu'
  args: ['bash', './.cloudbuild/write-latest.sh', '$COMMIT_SHA']
artifacts:
  objects:
    location: '$_GS_BUCKET_URI/'
    paths:
    - 'cloud_build_latest'
substitutions:
  _GS_BUCKET_URI: 'gs://$PROJECT_ID-cloud-build-artifacts/$REPO_NAME'
options:
 machineType: 'N1_HIGHCPU_32'
