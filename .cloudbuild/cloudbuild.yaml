steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-f', '.cloudbuild/Dockerfile.bazel-zip', '-t', 'bazel-zip', '.']
- name: 'bazel-zip'
  args:
  - 'build'
  - '//google/cloud/language/v1:gapi-cloud-language-v1-go'
  - '//google/cloud/language/v1:google-cloud-language-v1-java'
  - '//google/cloud/language/v1:google-cloud-language-v1-php'
  - '//google/cloud/vision/v1:gapi-cloud-vision-v1-go'
  - '//google/cloud/vision/v1:google-cloud-vision-v1-java'
- name: 'gcr.io/cloud-builders/gsutil'
  args: ['-m', 'cp', '-r', 'bazel-bin/google', 'gs://$PROJECT_ID-cloud-build-artifacts/$REPO_NAME/$COMMIT_SHA/google']
- name: 'ubuntu'
  args: ['echo', '"$COMMIT_SHA"', '>', 'cloud_build_latest']
artifacts:
  objects:
    location: 'gs://$PROJECT_ID-cloud-build-artifacts/$REPO_NAME/'
    paths:
    - 'cloud_build_latest'
options:
 machineType: 'N1_HIGHCPU_32'
